<div class="d-flex justify-content-between align-items-center mb-4">
  <h2 class="fw-bold">Staff Management</h2>
  <button
    class="btn btn-primary"
    data-bs-toggle="modal"
    data-bs-target="#addStaffModal"
  >
    <i class="bi bi-plus-lg"></i>
    Add New Staff
  </button>
</div>

<!-- BẢNG DANH SÁCH NHÂN VIÊN -->
<div class="card shadow-sm border-0">
  <div class="card-body">
    <table class="table table-hover align-middle">
      <thead class="table-dark">
        <tr>
          <th>Username</th>
          <th>Full Name</th>
          <th>Email</th>
          <th>Status</th>
          <th style="width: 150px;">Action</th>
        </tr>
      </thead>
      <tbody>
        {{#each staffList}}
          <tr>
            <td>{{this.username}}</td>
            <td>{{this.first_name}} {{this.last_name}}</td>
            <td>{{this.email}}</td>
            <td>
              {{#if this.is_active}}
                <span class="badge bg-success">Active</span>
              {{else}}
                <span class="badge bg-secondary">Inactive</span>
              {{/if}}
            </td>
            <td>
              <!-- NÚT SỬA: Lưu dữ liệu vào data attribute để JS lấy -->
              <button
                class="btn btn-sm btn-warning me-1 btn-edit"
                data-id="{{this.id}}"
                data-first="{{this.first_name}}"
                data-last="{{this.last_name}}"
                data-email="{{this.email}}"
                data-phone="{{this.phone_number}}"
                data-active="{{this.is_active}}"
                data-bs-toggle="modal"
                data-bs-target="#editStaffModal"
              >
                <i class="bi bi-pencil-fill"></i>
              </button>

              <!-- NÚT XÓA -->
              <form
                action="/admin/staff/delete/{{this.id}}"
                method="POST"
                class="d-inline"
                onsubmit="return confirm('Bạn có chắc chắn muốn xóa nhân viên {{this.username}} không?')"
              >
                <button type="submit" class="btn btn-sm btn-danger">
                  <i class="bi bi-trash-fill"></i>
                </button>
              </form>
            </td>
          </tr>
        {{/each}}
      </tbody>
    </table>
  </div>
</div>

<!-- 1. MODAL THÊM MỚI (ADD) -->
<div class="modal fade" id="addStaffModal" tabindex="-1">
  <div class="modal-dialog">
    <form action="/admin/staff/add" method="POST" class="modal-content">
      <div class="modal-header bg-primary text-white">
        <h5 class="modal-title">Add New Staff</h5>
        <button
          type="button"
          class="btn-close btn-close-white"
          data-bs-dismiss="modal"
        ></button>
      </div>
      <div class="modal-body">
        <div class="row mb-3">
          <div class="col">
            <label class="form-label">Username</label>
            <input type="text" name="username" class="form-control" required />
          </div>
          <div class="col">
            <label class="form-label">Password</label>
            <input
              type="password"
              name="password"
              class="form-control"
              required
            />
          </div>
        </div>
        <div class="row mb-3">
          <div class="col">
            <label class="form-label">First Name</label>
            <input
              type="text"
              name="first_name"
              class="form-control"
              required
            />
          </div>
          <div class="col">
            <label class="form-label">Last Name</label>
            <input type="text" name="last_name" class="form-control" required />
          </div>
        </div>
        <div class="mb-3">
          <label class="form-label">Email</label>
          <input type="email" name="email" class="form-control" required />
        </div>
        <div class="mb-3">
          <label class="form-label">Phone Number</label>
          <input
            type="text"
            name="phone_number"
            class="form-control"
            required
          />
        </div>
      </div>
      <div class="modal-footer">
        <button
          type="button"
          class="btn btn-secondary"
          data-bs-dismiss="modal"
        >Close</button>
        <button type="submit" class="btn btn-primary">Create Staff</button>
      </div>
    </form>
  </div>
</div>

<!-- 2. MODAL SỬA (UPDATE) -->
<div class="modal fade" id="editStaffModal" tabindex="-1">
  <div class="modal-dialog">
    <!-- Form này chưa có action, JS sẽ tự điền action khi mở modal -->
    <form id="editForm" method="POST" class="modal-content">
      <div class="modal-header bg-warning text-dark">
        <h5 class="modal-title">Update Staff Information</h5>
        <button
          type="button"
          class="btn-close"
          data-bs-dismiss="modal"
        ></button>
      </div>
      <div class="modal-body">
        <!-- Không cho sửa Username/Password -->
        <div class="row mb-3">
          <div class="col">
            <label class="form-label">First Name</label>
            <input
              type="text"
              name="first_name"
              id="edit_first"
              class="form-control"
              required
            />
          </div>
          <div class="col">
            <label class="form-label">Last Name</label>
            <input
              type="text"
              name="last_name"
              id="edit_last"
              class="form-control"
              required
            />
          </div>
        </div>
        <div class="mb-3">
          <label class="form-label">Email</label>
          <input
            type="email"
            name="email"
            id="edit_email"
            class="form-control"
            required
          />
        </div>
        <div class="mb-3">
          <label class="form-label">Phone Number</label>
          <input
            type="text"
            name="phone_number"
            id="edit_phone"
            class="form-control"
            required
          />
        </div>

        <!-- Checkbox Active -->
        <div class="form-check form-switch p-3 border rounded bg-light">
          <input
            class="form-check-input"
            type="checkbox"
            name="is_active"
            id="edit_active"
          />
          <label class="form-check-label fw-bold" for="edit_active">Is Active
            Account?</label>
        </div>
      </div>
      <div class="modal-footer">
        <button
          type="button"
          class="btn btn-secondary"
          data-bs-dismiss="modal"
        >Close</button>
        <button type="submit" class="btn btn-warning">Update Changes</button>
      </div>
    </form>
  </div>
</div>

<!-- JAVASCRIPT XỬ LÝ LOGIC -->
<script>
  (function () { const editModal = document.getElementById('editStaffModal'); if
  (!editModal) return; editModal.addEventListener('show.bs.modal', function
  (event) { const button = event.relatedTarget; if (!button) return; const id =
  button.getAttribute('data-id') || ''; const first =
  button.getAttribute('data-first') || ''; const last =
  button.getAttribute('data-last') || ''; const email =
  button.getAttribute('data-email') || ''; const phone =
  button.getAttribute('data-phone') || ''; const activeRaw =
  button.getAttribute('data-active'); const isActive = (activeRaw === 'true' ||
  activeRaw === '1'); const inputFirst = document.getElementById('edit_first');
  const inputLast = document.getElementById('edit_last'); const inputEmail =
  document.getElementById('edit_email'); const inputPhone =
  document.getElementById('edit_phone'); const inputActive =
  document.getElementById('edit_active'); const form =
  document.getElementById('editForm'); if (inputFirst) inputFirst.value = first;
  if (inputLast) inputLast.value = last; if (inputEmail) inputEmail.value =
  email; if (inputPhone) inputPhone.value = phone; if (inputActive)
  inputActive.checked = isActive; if (form) form.action = '/admin/staff/edit/' +
  id; }); })();
</script>
<!-- Delete uses POST form; native confirm() onsubmit handles confirmation -->